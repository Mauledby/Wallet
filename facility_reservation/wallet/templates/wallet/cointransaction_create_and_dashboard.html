{% extends 'wallet/userbase.html' %} {% load static %} {% block body_block %}
<link
  href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.10.0/dist/css/bootstrap-datepicker.min.css"
/>
<style>
  #page-content-wrapper {
    background: url("{% static 'img/basebg.PNG' %}") no-repeat;
    background-size: cover;
  }

  .jumbotron {
    background-color: rgba(254, 255, 255, 0.8);
    border: 2px solid #333;
    color: #ffffff;
    margin: 0 auto;
  }

  .nav-tabs .nav-link {
    margin-right: 5px;
    color: #555;
    background-color: #e9ecef;
  }

  .nav-tabs .nav-link.active {
    color: #ffff;
    background-color: #9c7b16;
  }

  .box {
    display: flex;
    justify-content: center;
    align-self: center;
    flex-direction: column;
    width: fit-content;
    height: fit-content;
    border: 2px solid #333;
    border-radius: 10px;
    padding: 20px;
  }

  .box1 {
    display: flex;
    justify-content: center;
    flex-direction: column;
    width: 344px;
    height: 246px;
    border: 2px solid #333;
    border-radius: 10px;
    padding: 20px;
  }

  .box2 {
    display: flex;
    align-self: center;
    justify-content: center;
    flex-direction: column;
    width: fit-content;
    height: fit-content;
    border: 2px solid #333;
    border-radius: 10px;
    padding: 20px;
  }

  .custom-button {
    width: 300px;
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center center;
    text-align: center;
    padding: 20px;
    font-size: 30px;
    font-weight: bold;
    color: white;
    border: solid black;
    cursor: pointer;
    margin-bottom: 10px;
    -webkit-text-stroke: 1px black;
  }

  .btn-bg-1 {
    background-image: url('{% static "img/technoBg.jpg" %}');
  }

  .btn-bg-2 {
    background-image: url('{% static "img/coffee.png" %}');
  }
  label {
    color: #000;
  }

  /* for form */
  .coin-transaction-form {
    max-width: 400px;
    margin: 0 auto;
  }

  .form-group {
    margin-bottom: 20px;
  }

  label {
    font-weight: bold;
    color: #333;
  }

  input[type="number"] {
    max-width: 100px;
  }
  input[type="date"],
  input[type="file"] {
    max-width: 250px;
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
  }

  input[type="date"]::-webkit-calendar-picker-indicator {
    background: transparent;
    padding: 5px;
    border: none;
    cursor: pointer;
  }

  button[type="submit"] {
    background-color: #007bff;
    color: #fff;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
</style>
<div class="container custom-container" style="margin-top: 20px">
  <ul class="nav nav-tabs">
    <li class="nav-item">
      <a class="nav-link active" data-toggle="tab" href="#coinsdash"
        >Dashboard</a
      >
    </li>
    <li class="nav-item">
      <a class="nav-link" data-toggle="tab" href="#top-up">Top-up</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-toggle="tab" href="#myrequests">My Requests</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-toggle="tab" href="#paymentsTab"
        >Payments Made</a
      >
    </li>
  </ul>

  <!-- Tab content -->
  <div class="tab-content">
    <div class="tab-pane fade show active" id="coinsdash">
      <div class="jumbotron">
        <h1 style="color: #000">Points</h1>
        <div class="box2 mx-auto">
          <h3 style="color: #000">Welcome, {{first_name}} {{last_name}} !</h3>
          <div class="row">
            <div class="col">
              <h6 style="color: #000">Coins</h6>
              <div
                class="box1"
                style="align-items: center; background-color: white"
              >
                <h1 style="color: #000; font-family: Arial, sans-serif">
                  {{ coin_balance }}
                  <img
                    src="{% static 'img/dollar.png' %}"
                    alt="Point Icon"
                    style="
                      vertical-align: middle;
                      margin-right: 5px;
                      margin-bottom: 5px;
                      height: 1.2em;
                    "
                  />
                </h1>
              </div>
            </div>
            <div class="col">
              <h6 style="color: #000">Where to Spend?</h6>
              <div
                class="box"
                style="align-items: center; background-color: bisque"
              >
                <button class="btn custom-button btn-lg btn-bg-1">
                  Make Reservation
                </button>
                <button class="btn custom-button btn-lg btn-bg-2">
                  Buy Coffee
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="top-up">
      <div class="jumbotron">
        <h1 style="color: #000">Top-up</h1>
        <form method="post" enctype="multipart/form-data" id="topup">
          {% csrf_token %} {{ form.as_p }}
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </div>

    <div class="tab-pane fade" id="myrequests">
      <div class="jumbotron">
        <h1 style="color: #000">My Requests</h1>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Unique Code</th>
              <th>Amount</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for transaction in coin_transactions %}
            <tr>
              <td>{{ transaction.reference_code }}</td>
              <td>{{ transaction.amount }}</td>
              <!-- prettier-ignore -->
              <td>
              {% if transaction.is_completed and not transaction.is_denied %}
                <span style="color: green;"><strong>Approved</strong></span>
              {% elif not transaction.is_completed and transaction.is_denied %}
                <span style="color: red;"><strong>Denied</strong></span>
              {% else %}
                <span style="color: yellow;"><strong>Pending</strong></span>
              {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="2">No requests found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="tab-pane fade" id="paymentsTab">
      <div class="jumbotron">
        <h1 style="color: #000">Payments</h1>
        <div
          class="table-container"
          style="max-height: 450px; overflow-y: auto"
        >
          <table id="payments" class="table table-striped table-bordered">
            <thead
              class="thead-dark"
              style="position: sticky; top: 0; background-color: white"
            >
              <tr>
                <th>Reference Code</th>
                <th>Date</th>
                <th>Description</th>
                <th>Transaction Date</th>
                <th>Transaction ID</th>
                <th>Transaction Amount</th>
                <th>Customer ID</th>
              </tr>
            </thead>
            <tbody>
              {% for vendor_transaction in vendor_transactions %}
              <tr>
                <td>{{ vendor_transaction.reference_code }}</td>
                <td>{{ vendor_transaction.date }}</td>
                <td>{{ vendor_transaction.description }}</td>
                <td>{{ vendor_transaction.transaction_date }}</td>
                <td>{{ vendor_transaction.transaction_id }}</td>
                <td>{{ vendor_transaction.transaction_amount }}</td>
                <td>{{ vendor_transaction.customer_id }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.10.0/dist/js/bootstrap-datepicker.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.10.0/dist/js/bootstrap-datepicker.min.js"></script>

  <script>
    $("#id_date_in_receipt").datepicker({
      format: "mm/dd/yyyy", // You can customize the date format
      autoclose: true, // Close the date picker when a date is selected
    });
    // Assuming your form has an ID of "topup"
    const form = document.querySelector("#topup");

    form.addEventListener("submit", (event) => {
      // Prevent the form from submitting normally
      event.preventDefault();

      // Get the form data
      const formData = new FormData(form);

      // Send an AJAX request to the server
      fetch(".", {
        method: "POST",
        body: formData,
      })
        .then((response) => {
          // Display an alert if the form is successfully saved
          if (response.ok) {
            alert("Form saved successfully!");
            form.reset();
          }
        })
        .catch((error) => {
          console.error(error);
        });
    });
  </script>

  {% endblock %}
</div>
